---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.0
  name: authpolicies.avapigw.vyrodovalexey.github.com
spec:
  group: avapigw.vyrodovalexey.github.com
  names:
    kind: AuthPolicy
    listKind: AuthPolicyList
    plural: authpolicies
    shortNames:
    - ap
    singular: authpolicy
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.targetRef.name
      name: Target
      type: string
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          AuthPolicy is the Schema for the authpolicies API.
          AuthPolicy defines authentication and authorization configuration for a target resource.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: AuthPolicySpec defines the desired state of AuthPolicy
            properties:
              authentication:
                description: Authentication defines authentication configuration.
                properties:
                  apiKey:
                    description: APIKey defines API key authentication configuration.
                    properties:
                      enabled:
                        default: false
                        description: Enabled indicates whether API key authentication
                          is enabled.
                        type: boolean
                      location:
                        description: Location defines where to find the API key.
                        properties:
                          header:
                            default: X-API-Key
                            description: Header is the name of the header containing
                              the API key.
                            maxLength: 256
                            minLength: 1
                            type: string
                          queryParam:
                            description: QueryParam is the name of the query parameter
                              containing the API key.
                            maxLength: 256
                            minLength: 1
                            type: string
                        type: object
                      validation:
                        description: Validation defines how to validate the API key.
                        properties:
                          external:
                            description: |-
                              External defines external validation configuration.
                              Required when Type is External.
                            properties:
                              headers:
                                description: Headers defines headers to include in
                                  the validation request.
                                items:
                                  description: HTTPHeader represents an HTTP header
                                    name and value
                                  properties:
                                    name:
                                      description: Name is the name of the HTTP header
                                      maxLength: 256
                                      minLength: 1
                                      pattern: ^[A-Za-z0-9!#$%&'*+\-.^_\x60|~]+$
                                      type: string
                                    value:
                                      description: Value is the value of the HTTP
                                        header
                                      maxLength: 4096
                                      type: string
                                  required:
                                  - name
                                  - value
                                  type: object
                                maxItems: 8
                                type: array
                              timeout:
                                default: 5s
                                description: Timeout is the timeout for the validation
                                  request.
                                pattern: ^([0-9]+(ms|s))+$
                                type: string
                              url:
                                description: URL is the URL of the external validation
                                  service.
                                maxLength: 2048
                                minLength: 1
                                type: string
                            required:
                            - url
                            type: object
                          secretRef:
                            description: |-
                              SecretRef references a Secret containing valid API keys.
                              Required when Type is Secret.
                            properties:
                              name:
                                description: Name is the name of the secret
                                maxLength: 253
                                minLength: 1
                                type: string
                              namespace:
                                description: |-
                                  Namespace is the namespace of the secret
                                  If not specified, the namespace of the referrer is used
                                maxLength: 63
                                minLength: 1
                                type: string
                            required:
                            - name
                            type: object
                          type:
                            allOf:
                            - enum:
                              - Secret
                              - External
                            - enum:
                              - Secret
                              - External
                            description: Type is the type of validation.
                            type: string
                        required:
                        - type
                        type: object
                    type: object
                  basic:
                    description: Basic defines basic authentication configuration.
                    properties:
                      enabled:
                        default: false
                        description: Enabled indicates whether basic authentication
                          is enabled.
                        type: boolean
                      realm:
                        default: Restricted
                        description: Realm is the authentication realm.
                        maxLength: 256
                        type: string
                      secretRef:
                        description: SecretRef references a Secret containing username:password
                          pairs.
                        properties:
                          name:
                            description: Name is the name of the secret
                            maxLength: 253
                            minLength: 1
                            type: string
                          namespace:
                            description: |-
                              Namespace is the namespace of the secret
                              If not specified, the namespace of the referrer is used
                            maxLength: 63
                            minLength: 1
                            type: string
                        required:
                        - name
                        type: object
                    type: object
                  jwt:
                    description: JWT defines JWT authentication configuration.
                    properties:
                      audiences:
                        description: Audiences is the list of expected audiences.
                        items:
                          type: string
                        maxItems: 8
                        type: array
                      claimsToHeaders:
                        description: ClaimsToHeaders defines claims to extract and
                          add as headers.
                        items:
                          description: ClaimToHeader defines a claim to extract and
                            add as a header
                          properties:
                            claim:
                              description: Claim is the name of the JWT claim.
                              maxLength: 256
                              minLength: 1
                              type: string
                            header:
                              description: Header is the name of the header to add.
                              maxLength: 256
                              minLength: 1
                              type: string
                          required:
                          - claim
                          - header
                          type: object
                        maxItems: 16
                        type: array
                      enabled:
                        default: false
                        description: Enabled indicates whether JWT authentication
                          is enabled.
                        type: boolean
                      forwardOriginalToken:
                        default: false
                        description: ForwardOriginalToken indicates whether to forward
                          the original token.
                        type: boolean
                      issuer:
                        description: Issuer is the expected issuer of the JWT.
                        maxLength: 2048
                        minLength: 1
                        type: string
                      jwks:
                        description: JWKS references a Secret containing the JWKS.
                        properties:
                          name:
                            description: Name is the name of the secret
                            maxLength: 253
                            minLength: 1
                            type: string
                          namespace:
                            description: |-
                              Namespace is the namespace of the secret
                              If not specified, the namespace of the referrer is used
                            maxLength: 63
                            minLength: 1
                            type: string
                        required:
                        - name
                        type: object
                      jwksCacheDuration:
                        default: 1h
                        description: JWKSCacheDuration is the duration to cache the
                          JWKS.
                        type: string
                      jwksUri:
                        description: JWKSUri is the URI to fetch the JWKS from.
                        maxLength: 2048
                        minLength: 1
                        type: string
                      requiredClaims:
                        description: RequiredClaims defines claims that must be present
                          in the JWT.
                        items:
                          description: RequiredClaim defines a required JWT claim
                          properties:
                            name:
                              description: Name is the name of the claim.
                              maxLength: 256
                              minLength: 1
                              type: string
                            values:
                              description: Values is the list of allowed values for
                                the claim.
                              items:
                                type: string
                              maxItems: 16
                              type: array
                          required:
                          - name
                          type: object
                        maxItems: 16
                        type: array
                      tokenLocation:
                        description: TokenLocation defines where to find the JWT token.
                        properties:
                          cookie:
                            description: Cookie is the name of the cookie containing
                              the token.
                            maxLength: 128
                            minLength: 1
                            type: string
                          header:
                            default: Authorization
                            description: Header is the name of the header containing
                              the token.
                            maxLength: 256
                            minLength: 1
                            type: string
                          prefix:
                            default: 'Bearer '
                            description: Prefix is the prefix to strip from the header
                              value.
                            maxLength: 64
                            type: string
                          queryParam:
                            description: QueryParam is the name of the query parameter
                              containing the token.
                            maxLength: 256
                            minLength: 1
                            type: string
                        type: object
                    type: object
                  oauth2:
                    description: OAuth2 defines OAuth2 client credentials configuration.
                    properties:
                      clientId:
                        description: ClientID is the OAuth2 client ID.
                        maxLength: 256
                        minLength: 1
                        type: string
                      clientSecretRef:
                        description: ClientSecretRef references a Secret containing
                          the client secret.
                        properties:
                          name:
                            description: Name is the name of the secret
                            maxLength: 253
                            minLength: 1
                            type: string
                          namespace:
                            description: |-
                              Namespace is the namespace of the secret
                              If not specified, the namespace of the referrer is used
                            maxLength: 63
                            minLength: 1
                            type: string
                        required:
                        - name
                        type: object
                      enabled:
                        default: false
                        description: Enabled indicates whether OAuth2 is enabled.
                        type: boolean
                      scopes:
                        description: Scopes is the list of OAuth2 scopes.
                        items:
                          type: string
                        maxItems: 16
                        type: array
                      tokenEndpoint:
                        description: TokenEndpoint is the OAuth2 token endpoint.
                        maxLength: 2048
                        minLength: 1
                        type: string
                    type: object
                type: object
              authorization:
                description: Authorization defines authorization configuration.
                properties:
                  defaultAction:
                    allOf:
                    - enum:
                      - ALLOW
                      - DENY
                    - enum:
                      - ALLOW
                      - DENY
                    default: DENY
                    description: DefaultAction is the default action when no rules
                      match.
                    type: string
                  rules:
                    description: Rules defines authorization rules.
                    items:
                      description: AuthorizationRule defines an authorization rule
                      properties:
                        action:
                          allOf:
                          - enum:
                            - ALLOW
                            - DENY
                          - enum:
                            - ALLOW
                            - DENY
                          default: ALLOW
                          description: Action is the action to take when the rule
                            matches.
                          type: string
                        name:
                          description: Name is the name of the rule.
                          maxLength: 253
                          minLength: 1
                          type: string
                        to:
                          description: To defines the operations this rule applies
                            to.
                          items:
                            description: AuthorizationTarget defines the target of
                              an authorization rule
                            properties:
                              operation:
                                description: Operation defines the operation to match.
                                properties:
                                  hosts:
                                    description: Hosts is the list of hosts to match.
                                    items:
                                      type: string
                                    maxItems: 8
                                    type: array
                                  methods:
                                    description: Methods is the list of HTTP methods
                                      to match.
                                    items:
                                      type: string
                                    maxItems: 8
                                    type: array
                                  paths:
                                    description: Paths is the list of paths to match.
                                    items:
                                      type: string
                                    maxItems: 16
                                    type: array
                                  ports:
                                    description: Ports is the list of ports to match.
                                    items:
                                      format: int32
                                      type: integer
                                    maxItems: 8
                                    type: array
                                type: object
                            type: object
                          maxItems: 8
                          type: array
                        when:
                          description: When defines conditions that must be met for
                            the rule to apply.
                          items:
                            description: AuthorizationCondition defines a condition
                              for authorization
                            properties:
                              claim:
                                description: Claim is the name of the JWT claim to
                                  match.
                                maxLength: 256
                                minLength: 1
                                type: string
                              header:
                                description: Header is the name of the header to match.
                                maxLength: 256
                                minLength: 1
                                type: string
                              matchPath:
                                description: MatchPath enables dynamic matching against
                                  path parameters.
                                maxLength: 1024
                                type: string
                              sourceIP:
                                description: SourceIP defines source IP matching.
                                properties:
                                  cidrs:
                                    description: CIDRs is the list of CIDR ranges
                                      to match.
                                    items:
                                      type: string
                                    maxItems: 16
                                    type: array
                                  notCidrs:
                                    description: NotCIDRs is the list of CIDR ranges
                                      to not match.
                                    items:
                                      type: string
                                    maxItems: 16
                                    type: array
                                type: object
                              values:
                                description: Values is the list of values to match.
                                items:
                                  type: string
                                maxItems: 16
                                type: array
                            type: object
                          maxItems: 8
                          type: array
                      required:
                      - name
                      type: object
                    maxItems: 32
                    type: array
                type: object
              securityHeaders:
                description: SecurityHeaders defines security headers configuration.
                properties:
                  contentSecurityPolicy:
                    description: ContentSecurityPolicy is the Content-Security-Policy
                      header value.
                    maxLength: 4096
                    type: string
                  cors:
                    description: CORS defines CORS configuration.
                    properties:
                      allowCredentials:
                        default: false
                        description: AllowCredentials indicates whether credentials
                          are allowed.
                        type: boolean
                      allowHeaders:
                        description: AllowHeaders defines allowed headers.
                        items:
                          type: string
                        maxItems: 32
                        type: array
                      allowMethods:
                        description: AllowMethods defines allowed HTTP methods.
                        items:
                          type: string
                        maxItems: 8
                        type: array
                      allowOrigins:
                        description: AllowOrigins defines allowed origins.
                        items:
                          description: CORSOrigin defines a CORS origin
                          properties:
                            exact:
                              description: Exact is an exact origin match.
                              maxLength: 2048
                              type: string
                            prefix:
                              description: Prefix is a prefix origin match.
                              maxLength: 2048
                              type: string
                            regex:
                              description: Regex is a regex origin match.
                              maxLength: 2048
                              type: string
                          type: object
                        maxItems: 16
                        type: array
                      enabled:
                        default: false
                        description: Enabled indicates whether CORS is enabled.
                        type: boolean
                      exposeHeaders:
                        description: ExposeHeaders defines headers to expose.
                        items:
                          type: string
                        maxItems: 32
                        type: array
                      maxAge:
                        description: MaxAge is the max age for preflight requests.
                        type: string
                    type: object
                  hsts:
                    description: HSTS defines HSTS configuration.
                    properties:
                      enabled:
                        default: false
                        description: Enabled indicates whether HSTS is enabled.
                        type: boolean
                      includeSubDomains:
                        default: true
                        description: IncludeSubDomains indicates whether to include
                          subdomains.
                        type: boolean
                      maxAge:
                        default: 31536000
                        description: MaxAge is the max age in seconds.
                        format: int32
                        maximum: 63072000
                        minimum: 0
                        type: integer
                      preload:
                        default: false
                        description: Preload indicates whether to enable HSTS preload.
                        type: boolean
                    type: object
                  permissionsPolicy:
                    description: PermissionsPolicy is the Permissions-Policy header
                      value.
                    maxLength: 4096
                    type: string
                  referrerPolicy:
                    description: ReferrerPolicy is the Referrer-Policy header value.
                    enum:
                    - no-referrer
                    - no-referrer-when-downgrade
                    - origin
                    - origin-when-cross-origin
                    - same-origin
                    - strict-origin
                    - strict-origin-when-cross-origin
                    - unsafe-url
                    type: string
                  xContentTypeOptions:
                    description: XContentTypeOptions is the X-Content-Type-Options
                      header value.
                    enum:
                    - nosniff
                    type: string
                  xFrameOptions:
                    description: XFrameOptions is the X-Frame-Options header value.
                    enum:
                    - DENY
                    - SAMEORIGIN
                    type: string
                  xXSSProtection:
                    description: XXSSProtection is the X-XSS-Protection header value.
                    maxLength: 256
                    type: string
                type: object
              targetRef:
                description: TargetRef identifies the target resource to apply authentication
                  to.
                properties:
                  group:
                    description: Group is the group of the target resource
                    maxLength: 253
                    type: string
                  kind:
                    description: Kind is the kind of the target resource
                    maxLength: 63
                    minLength: 1
                    type: string
                  name:
                    description: Name is the name of the target resource
                    maxLength: 253
                    minLength: 1
                    type: string
                  namespace:
                    description: |-
                      Namespace is the namespace of the target resource
                      When unspecified, the local namespace is inferred
                    maxLength: 63
                    minLength: 1
                    type: string
                  sectionName:
                    description: |-
                      SectionName is the name of a section within the target resource
                      When unspecified, this targets the entire resource
                    maxLength: 253
                    minLength: 1
                    type: string
                required:
                - group
                - kind
                - name
                type: object
            required:
            - targetRef
            type: object
          status:
            description: AuthPolicyStatus defines the observed state of AuthPolicy
            properties:
              conditions:
                description: Conditions represent the latest available observations
                  of an object's state
                items:
                  description: Condition represents a condition of a resource
                  properties:
                    lastTransitionTime:
                      description: LastTransitionTime is the last time the condition
                        transitioned from one status to another
                      format: date-time
                      type: string
                    message:
                      description: Message is a human-readable message indicating
                        details about the transition
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: ObservedGeneration represents the .metadata.generation
                        that the condition was set based upon
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: Reason is a brief reason for the condition's last
                        transition
                      maxLength: 1024
                      minLength: 1
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: Type of condition
                      type: string
                  required:
                  - lastTransitionTime
                  - reason
                  - status
                  - type
                  type: object
                maxItems: 8
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              lastReconciledTime:
                description: LastReconciledTime is the last time the resource was
                  reconciled
                format: date-time
                type: string
              observedGeneration:
                description: ObservedGeneration reflects the generation of the most
                  recently observed resource
                format: int64
                type: integer
              phase:
                description: Phase represents the current phase of the resource
                enum:
                - Pending
                - Ready
                - Error
                - Reconciling
                - Degraded
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
