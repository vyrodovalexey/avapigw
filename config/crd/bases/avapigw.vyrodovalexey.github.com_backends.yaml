---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.17.0
  name: backends.avapigw.vyrodovalexey.github.com
spec:
  group: avapigw.vyrodovalexey.github.com
  names:
    kind: Backend
    listKind: BackendList
    plural: backends
    shortNames:
    - be
    singular: backend
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .status.phase
      name: Phase
      type: string
    - jsonPath: .status.healthyEndpoints
      name: Healthy
      type: integer
    - jsonPath: .status.totalEndpoints
      name: Total
      type: integer
    - jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: |-
          Backend is the Schema for the backends API.
          Backend defines a backend service with load balancing, health checking,
          and connection pooling configuration.
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: BackendSpec defines the desired state of Backend
            properties:
              circuitBreaker:
                description: CircuitBreaker defines the circuit breaker configuration.
                properties:
                  baseEjectionTime:
                    default: 30s
                    description: BaseEjectionTime is the base time an endpoint is
                      ejected.
                    type: string
                  consecutiveErrors:
                    default: 5
                    description: ConsecutiveErrors is the number of consecutive errors
                      before opening the circuit.
                    format: int32
                    maximum: 100
                    minimum: 1
                    type: integer
                  enabled:
                    default: false
                    description: Enabled indicates whether circuit breaking is enabled.
                    type: boolean
                  interval:
                    default: 30s
                    description: Interval is the time interval for counting errors.
                    type: string
                  maxEjectionPercent:
                    default: 50
                    description: MaxEjectionPercent is the maximum percentage of endpoints
                      that can be ejected.
                    format: int32
                    maximum: 100
                    minimum: 0
                    type: integer
                type: object
              connectionPool:
                description: ConnectionPool defines the connection pool configuration.
                properties:
                  http:
                    description: HTTP defines HTTP connection pool settings.
                    properties:
                      h2UpgradePolicy:
                        allOf:
                        - enum:
                          - DO_NOT_UPGRADE
                          - UPGRADE
                        - enum:
                          - DO_NOT_UPGRADE
                          - UPGRADE
                        default: DO_NOT_UPGRADE
                        description: H2UpgradePolicy specifies the HTTP/2 upgrade
                          policy.
                        type: string
                      idleTimeout:
                        default: 60s
                        description: IdleTimeout is the idle timeout for connections.
                        type: string
                      maxConnections:
                        default: 100
                        description: MaxConnections is the maximum number of connections
                          to the backend.
                        format: int32
                        maximum: 1000000
                        minimum: 1
                        type: integer
                      maxPendingRequests:
                        default: 100
                        description: MaxPendingRequests is the maximum number of pending
                          requests.
                        format: int32
                        maximum: 1000000
                        minimum: 1
                        type: integer
                      maxRequestsPerConnection:
                        default: 0
                        description: MaxRequestsPerConnection is the maximum number
                          of requests per connection.
                        format: int32
                        maximum: 1000000
                        minimum: 0
                        type: integer
                      useClientProtocol:
                        default: false
                        description: UseClientProtocol indicates whether to use the
                          client's protocol.
                        type: boolean
                    type: object
                  tcp:
                    description: TCP defines TCP connection pool settings.
                    properties:
                      connectTimeout:
                        default: 10s
                        description: ConnectTimeout is the timeout for establishing
                          a connection.
                        type: string
                      maxConnections:
                        default: 100
                        description: MaxConnections is the maximum number of connections
                          to the backend.
                        format: int32
                        maximum: 1000000
                        minimum: 1
                        type: integer
                      tcpKeepalive:
                        description: TCPKeepalive defines TCP keepalive settings.
                        properties:
                          interval:
                            description: Interval is the interval between keepalive
                              probes.
                            type: string
                          probes:
                            description: Probes is the number of keepalive probes
                              to send.
                            format: int32
                            maximum: 10
                            minimum: 1
                            type: integer
                          time:
                            description: Time is the time before sending keepalive
                              probes.
                            type: string
                        type: object
                    type: object
                type: object
              endpoints:
                description: |-
                  Endpoints defines direct endpoints for the backend.
                  Either Service or Endpoints must be specified, but not both.
                items:
                  description: EndpointConfig defines a direct endpoint
                  properties:
                    address:
                      description: Address is the IP address or hostname of the endpoint.
                      maxLength: 253
                      minLength: 1
                      type: string
                    port:
                      description: Port is the port of the endpoint.
                      format: int32
                      maximum: 65535
                      minimum: 1
                      type: integer
                    weight:
                      default: 1
                      description: Weight specifies the proportion of traffic to forward
                        to this endpoint.
                      format: int32
                      maximum: 1000000
                      minimum: 0
                      type: integer
                  required:
                  - address
                  - port
                  type: object
                maxItems: 100
                type: array
              healthCheck:
                description: HealthCheck defines the health check configuration.
                properties:
                  enabled:
                    default: true
                    description: Enabled indicates whether health checking is enabled.
                    type: boolean
                  grpc:
                    description: GRPC defines gRPC health check configuration.
                    properties:
                      service:
                        description: |-
                          Service is the gRPC service name to use for health checks.
                          If not specified, the standard gRPC health checking protocol is used.
                        maxLength: 1024
                        type: string
                    type: object
                  healthyThreshold:
                    default: 2
                    description: |-
                      HealthyThreshold is the number of consecutive successful health checks
                      required before considering an endpoint healthy.
                    format: int32
                    maximum: 10
                    minimum: 1
                    type: integer
                  http:
                    description: HTTP defines HTTP health check configuration.
                    properties:
                      expectedStatuses:
                        description: ExpectedStatuses is the list of HTTP status codes
                          that indicate a healthy endpoint.
                        items:
                          format: int32
                          type: integer
                        maxItems: 10
                        type: array
                      host:
                        description: Host is the value of the Host header in the HTTP
                          health check request.
                        maxLength: 253
                        type: string
                      method:
                        default: GET
                        description: Method is the HTTP method to use for health checks.
                        enum:
                        - GET
                        - HEAD
                        type: string
                      path:
                        description: Path is the HTTP path to use for health checks.
                        maxLength: 1024
                        minLength: 1
                        type: string
                    required:
                    - path
                    type: object
                  interval:
                    default: 10s
                    description: Interval is the interval between health checks.
                    type: string
                  tcp:
                    description: TCP defines TCP health check configuration.
                    properties:
                      receive:
                        description: Receive is the expected response data.
                        maxLength: 1024
                        type: string
                      send:
                        description: Send is the data to send for the health check.
                        maxLength: 1024
                        type: string
                    type: object
                  timeout:
                    default: 5s
                    description: Timeout is the timeout for a health check.
                    type: string
                  unhealthyThreshold:
                    default: 3
                    description: |-
                      UnhealthyThreshold is the number of consecutive failed health checks
                      required before considering an endpoint unhealthy.
                    format: int32
                    maximum: 10
                    minimum: 1
                    type: integer
                type: object
              loadBalancing:
                description: LoadBalancing defines the load balancing configuration.
                properties:
                  algorithm:
                    allOf:
                    - enum:
                      - RoundRobin
                      - LeastConnections
                      - Random
                      - ConsistentHash
                    - enum:
                      - RoundRobin
                      - LeastConnections
                      - Random
                      - ConsistentHash
                    default: RoundRobin
                    description: Algorithm is the load balancing algorithm.
                    type: string
                  consistentHash:
                    description: |-
                      ConsistentHash defines consistent hash configuration.
                      Required when Algorithm is ConsistentHash.
                    properties:
                      cookie:
                        description: |-
                          Cookie is the name of the cookie to use for consistent hashing.
                          Required when Type is Cookie.
                        maxLength: 128
                        minLength: 1
                        type: string
                      header:
                        description: |-
                          Header is the name of the header to use for consistent hashing.
                          Required when Type is Header.
                        maxLength: 256
                        minLength: 1
                        type: string
                      minimumRingSize:
                        default: 1024
                        description: MinimumRingSize is the minimum size of the hash
                          ring.
                        format: int32
                        maximum: 8388608
                        minimum: 1
                        type: integer
                      type:
                        allOf:
                        - enum:
                          - Header
                          - Cookie
                          - SourceIP
                        - enum:
                          - Header
                          - Cookie
                          - SourceIP
                        description: Type defines the type of consistent hash.
                        type: string
                    required:
                    - type
                    type: object
                type: object
              outlierDetection:
                description: OutlierDetection defines the outlier detection configuration.
                properties:
                  baseEjectionTime:
                    default: 30s
                    description: BaseEjectionTime is the base time an endpoint is
                      ejected.
                    type: string
                  consecutive5xxErrors:
                    default: 5
                    description: Consecutive5xxErrors is the number of consecutive
                      5xx errors before ejection.
                    format: int32
                    maximum: 100
                    minimum: 1
                    type: integer
                  consecutiveGatewayErrors:
                    default: 5
                    description: ConsecutiveGatewayErrors is the number of consecutive
                      gateway errors before ejection.
                    format: int32
                    maximum: 100
                    minimum: 1
                    type: integer
                  enabled:
                    default: false
                    description: Enabled indicates whether outlier detection is enabled.
                    type: boolean
                  interval:
                    default: 10s
                    description: Interval is the time interval for outlier detection
                      analysis.
                    type: string
                  maxEjectionPercent:
                    default: 10
                    description: MaxEjectionPercent is the maximum percentage of endpoints
                      that can be ejected.
                    format: int32
                    type: integer
                  splitExternalLocalOriginErrors:
                    default: false
                    description: SplitExternalLocalOriginErrors enables splitting
                      of local origin errors.
                    type: boolean
                type: object
              service:
                description: |-
                  Service references a Kubernetes Service as the backend.
                  Either Service or Endpoints must be specified, but not both.
                properties:
                  name:
                    description: Name is the name of the Service.
                    maxLength: 253
                    minLength: 1
                    type: string
                  namespace:
                    description: |-
                      Namespace is the namespace of the Service.
                      If not specified, the namespace of the Backend is used.
                    maxLength: 63
                    minLength: 1
                    type: string
                  port:
                    description: Port is the port of the Service.
                    format: int32
                    maximum: 65535
                    minimum: 1
                    type: integer
                required:
                - name
                - port
                type: object
              tls:
                description: TLS defines the TLS configuration for backend connections.
                properties:
                  caCertificateRef:
                    description: CACertificateRef references a Secret containing the
                      CA certificate.
                    properties:
                      name:
                        description: Name is the name of the secret
                        maxLength: 253
                        minLength: 1
                        type: string
                      namespace:
                        description: |-
                          Namespace is the namespace of the secret
                          If not specified, the namespace of the referrer is used
                        maxLength: 63
                        minLength: 1
                        type: string
                    required:
                    - name
                    type: object
                  certificateRef:
                    description: |-
                      CertificateRef references a Secret containing the client certificate.
                      Required when Mode is Mutual.
                    properties:
                      name:
                        description: Name is the name of the secret
                        maxLength: 253
                        minLength: 1
                        type: string
                      namespace:
                        description: |-
                          Namespace is the namespace of the secret
                          If not specified, the namespace of the referrer is used
                        maxLength: 63
                        minLength: 1
                        type: string
                    required:
                    - name
                    type: object
                  insecureSkipVerify:
                    default: false
                    description: InsecureSkipVerify skips TLS certificate verification.
                    type: boolean
                  mode:
                    allOf:
                    - enum:
                      - Simple
                      - Mutual
                      - Insecure
                    - enum:
                      - Simple
                      - Mutual
                      - Insecure
                    default: Simple
                    description: Mode defines the TLS mode for backend connections.
                    type: string
                  sni:
                    description: SNI is the Server Name Indication to use for TLS
                      connections.
                    maxLength: 253
                    minLength: 1
                    type: string
                type: object
            type: object
          status:
            description: BackendStatus defines the observed state of Backend
            properties:
              conditions:
                description: Conditions represent the latest available observations
                  of an object's state
                items:
                  description: Condition represents a condition of a resource
                  properties:
                    lastTransitionTime:
                      description: LastTransitionTime is the last time the condition
                        transitioned from one status to another
                      format: date-time
                      type: string
                    message:
                      description: Message is a human-readable message indicating
                        details about the transition
                      maxLength: 32768
                      type: string
                    observedGeneration:
                      description: ObservedGeneration represents the .metadata.generation
                        that the condition was set based upon
                      format: int64
                      minimum: 0
                      type: integer
                    reason:
                      description: Reason is a brief reason for the condition's last
                        transition
                      maxLength: 1024
                      minLength: 1
                      type: string
                    status:
                      description: Status of the condition, one of True, False, Unknown
                      enum:
                      - "True"
                      - "False"
                      - Unknown
                      type: string
                    type:
                      description: Type of condition
                      type: string
                  required:
                  - lastTransitionTime
                  - reason
                  - status
                  - type
                  type: object
                maxItems: 8
                type: array
                x-kubernetes-list-map-keys:
                - type
                x-kubernetes-list-type: map
              endpoints:
                description: Endpoints is the list of endpoint statuses.
                items:
                  description: EndpointStatus defines the status of an endpoint
                  properties:
                    address:
                      description: Address is the address of the endpoint.
                      type: string
                    failureReason:
                      description: FailureReason is the reason for the endpoint being
                        unhealthy.
                      type: string
                    healthy:
                      description: Healthy indicates whether the endpoint is healthy.
                      type: boolean
                    lastCheckTime:
                      description: LastCheckTime is the last time the endpoint was
                        checked.
                      format: date-time
                      type: string
                    lastHealthyTime:
                      description: LastHealthyTime is the last time the endpoint was
                        healthy.
                      format: date-time
                      type: string
                    port:
                      description: Port is the port of the endpoint.
                      format: int32
                      type: integer
                  required:
                  - address
                  - healthy
                  - port
                  type: object
                maxItems: 100
                type: array
              healthyEndpoints:
                description: HealthyEndpoints is the number of healthy endpoints.
                format: int32
                type: integer
              lastReconciledTime:
                description: LastReconciledTime is the last time the resource was
                  reconciled
                format: date-time
                type: string
              observedGeneration:
                description: ObservedGeneration reflects the generation of the most
                  recently observed resource
                format: int64
                type: integer
              phase:
                description: Phase represents the current phase of the resource
                enum:
                - Pending
                - Ready
                - Error
                - Reconciling
                - Degraded
                type: string
              totalEndpoints:
                description: TotalEndpoints is the total number of endpoints.
                format: int32
                type: integer
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
